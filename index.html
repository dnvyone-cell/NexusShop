<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nexus App Store</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nexus">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5726/5726678.png">

    <!-- Depend√™ncias Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK Compat -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            background-color: #000000; 
            color: white;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Anima√ß√µes Globais */
        @keyframes loading-bar { from { transform: translateX(-100%); } to { transform: translateX(250%); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px) rotate(-5deg); } 75% { transform: translateX(4px) rotate(5deg); } }
        @keyframes toast-slide-in { from { transform: translateY(-100%) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Anima√ß√£o Suave de View */
        @keyframes viewTransition {
            from { opacity: 0; transform: translateY(10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Anima√ß√£o do Rob√¥ */
        @keyframes floatBot { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes flyAway { 
            0% { transform: translateY(0) scale(1); opacity: 1; } 
            20% { transform: translateY(20px) scale(0.9); } 
            100% { transform: translateY(-120vh) scale(0.5); opacity: 0; } 
        }
        @keyframes propulsion { 0% { height: 0px; opacity: 0; } 50% { height: 40px; opacity: 1; } 100% { height: 60px; opacity: 0.5; } }
        @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

        .view-animate { animation: viewTransition 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        .animate-toast-in { animation: toast-slide-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-scale-in { animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fly-away { animation: flyAway 1.2s cubic-bezier(0.7, 0, 0.84, 0) forwards; }
        .animate-float { animation: floatBot 3s ease-in-out infinite; }
        .animate-blink { animation: blink 4s infinite; }

        .shadow-ios { box-shadow: 0 8px 30px rgba(0,0,0,0.3); }
        .shadow-dock { box-shadow: 0 15px 40px -10px rgba(0,0,0,0.5); }
        
        .btn-get { border-radius: 9999px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.2s; }
        .btn-get:active { transform: scale(0.96); }

        .app-icon { border-radius: 22%; position: relative; overflow: hidden; box-shadow: 0 0 0 1px rgba(255,255,255,0.1); }
        input[type="date"], input[type="datetime-local"]::-webkit-calendar-picker-indicator { filter: invert(0.8); }
        .yt-iframe { pointer-events: none; transform: scale(1.5); transform-origin: center; }
        
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; }
        .file-input-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const APP_VERSION = "3.5"; 

        const firebaseConfig = {
            apiKey: "AIzaSyDcWSyP6S7LDuGQ1ZjFqKAHCZ8mjwJhEKY",
            authDomain: "nexus-hub-159db.firebaseapp.com",
            projectId: "nexus-hub-159db",
            storageBucket: "nexus-hub-159db.firebasestorage.app",
            messagingSenderId: "400199878551",
            appId: "1:400199878551:web:4f58353584daffbeb026d2"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        const DB_APP_ID = 'nexus-hub-permanent-vault';

        // --- Cores do Sistema ---
        const ACCENT_COLORS = {
            blue: { hex: '#2563eb', tailwind: 'blue-600', text: 'text-blue-500', bg: 'bg-blue-600', ring: 'focus:ring-blue-500', border: 'border-blue-500', soft: 'bg-blue-500/10' },
            purple: { hex: '#9333ea', tailwind: 'purple-600', text: 'text-purple-500', bg: 'bg-purple-600', ring: 'focus:ring-purple-500', border: 'border-purple-500', soft: 'bg-purple-500/10' },
            green: { hex: '#16a34a', tailwind: 'green-600', text: 'text-green-500', bg: 'bg-green-600', ring: 'focus:ring-green-500', border: 'border-green-500', soft: 'bg-green-500/10' },
            orange: { hex: '#ea580c', tailwind: 'orange-600', text: 'text-orange-500', bg: 'bg-orange-600', ring: 'focus:ring-orange-500', border: 'border-orange-500', soft: 'bg-orange-500/10' },
            pink: { hex: '#db2777', tailwind: 'pink-600', text: 'text-pink-500', bg: 'bg-pink-600', ring: 'focus:ring-pink-500', border: 'border-pink-500', soft: 'bg-pink-500/10' },
            red: { hex: '#dc2626', tailwind: 'red-600', text: 'text-red-500', bg: 'bg-red-600', ring: 'focus:ring-red-500', border: 'border-red-500', soft: 'bg-red-500/10' }
        };

        const openSystemLink = (url) => {
            if (!url) return alert("Link indispon√≠vel.");
            window.open(url, '_blank');
        };

        const THEMES = {
            amoled: { bg: 'bg-black', text: 'text-white', card: 'bg-[#1c1c1e]', border: 'border-white/10', subtext: 'text-zinc-500', glass: 'bg-black/80', input: 'bg-zinc-900', dock: 'bg-[#121212]/80' },
            matte: { bg: 'bg-[#121212]', text: 'text-zinc-100', card: 'bg-[#1e1e1e]', border: 'border-white/5', subtext: 'text-zinc-400', glass: 'bg-[#121212]/90', input: 'bg-[#252525]', dock: 'bg-[#1E1E1E]/80' },
            light: { bg: 'bg-[#f2f2f7]', text: 'text-black', card: 'bg-white', border: 'border-black/5', subtext: 'text-zinc-500', glass: 'bg-[#f2f2f7]/90', input: 'bg-white', dock: 'bg-white/80' }
        };

        const toLocalDatetimeString = (timestamp) => {
            if (!timestamp) return "";
            const date = new Date(timestamp);
            const pad = (n) => n.toString().padStart(2, '0');
            return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
        };

        const formatShortDate = (timestamp) => {
            if (!timestamp) return "";
            const date = new Date(timestamp);
            return date.toLocaleDateString('pt-PT', { day: '2-digit', month: 'short' }).toUpperCase();
        };

        const getYouTubeID = (url) => {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        };

        // --- Components ---

        function Icon({ name, size = 24, className = "", style = {} }) {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.lucide && containerRef.current && name) {
                    const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    containerRef.current.innerHTML = `<i data-lucide="${kebabName}"></i>`;
                    window.lucide.createIcons({ root: containerRef.current, attrs: { strokeWidth: 2, width: size, height: size, class: className, style: style } });
                }
            }, [name, size, className, style]);
            return <span ref={containerRef} className="flex items-center justify-center pointer-events-none"></span>;
        }

        // --- NEXUSBOT COMPONENT (Unified) ---
        function NexusBot({ mode = 'static', message, accentColor, onComplete, subMessage }) {
            // mode: 'greeting' | 'maintenance' | 'notice'
            const [stage, setStage] = useState(mode === 'greeting' ? 'enter' : 'static');

            useEffect(() => {
                if (mode === 'greeting') {
                    const timer1 = setTimeout(() => setStage('leave'), 2200);
                    const timer2 = setTimeout(onComplete, 3400);
                    return () => { clearTimeout(timer1); clearTimeout(timer2); };
                }
            }, [mode, onComplete]);

            const isLeaving = stage === 'leave';
            const animationClass = mode === 'greeting' ? (isLeaving ? 'animate-fly-away' : 'animate-float') : 'animate-float';

            return (
                <div className={`flex flex-col items-center justify-center ${isLeaving ? 'pointer-events-none' : ''} ${mode === 'greeting' ? 'fixed inset-0 z-[9999] bg-black' : ''}`}>
                    <div className={`flex flex-col items-center ${animationClass}`}>
                        {/* Robot Body */}
                        <div className="relative w-32 h-32">
                            {/* Antenna */}
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-4 w-1 h-6 bg-zinc-600"></div>
                            <div className="absolute top-[-20px] left-1/2 -translate-x-1/2 w-3 h-3 rounded-full animate-pulse" style={{ backgroundColor: accentColor }}></div>

                            {/* Head */}
                            <div className="w-full h-full bg-zinc-900 rounded-[30px] border-4 border-zinc-800 flex items-center justify-center relative shadow-2xl overflow-hidden">
                                {/* Face Screen */}
                                <div className="w-[80%] h-[60%] bg-black rounded-2xl flex items-center justify-center gap-4 relative overflow-hidden shadow-inner">
                                    {/* Eyes */}
                                    <div className={`w-6 h-8 rounded-full animate-blink delay-75 ${mode === 'maintenance' ? 'bg-yellow-500' : ''}`} style={{ backgroundColor: mode === 'maintenance' ? undefined : accentColor }}></div>
                                    <div className={`w-6 h-8 rounded-full animate-blink ${mode === 'maintenance' ? 'bg-yellow-500' : ''}`} style={{ backgroundColor: mode === 'maintenance' ? undefined : accentColor }}></div>

                                    {/* Scanline */}
                                    <div className="absolute inset-0 bg-gradient-to-b from-transparent via-white/5 to-transparent animate-[scan_2s_linear_infinite] opacity-30"></div>
                                </div>
                            </div>

                            {/* Propulsion (only for leaving greeting) */}
                            {isLeaving && (
                                <div className="absolute -bottom-10 left-1/2 -translate-x-1/2 w-10 bg-gradient-to-t from-transparent to-blue-400 rounded-full blur-md animate-[propulsion_0.5s_linear_infinite]"></div>
                            )}
                        </div>

                        {/* Text Bubble */}
                        <div className={`mt-8 bg-zinc-800 px-6 py-4 rounded-2xl border border-zinc-700 shadow-xl text-center max-w-xs transition-all duration-300 ${isLeaving ? 'opacity-0 scale-50' : 'opacity-100 scale-100'}`}>
                            <p className="text-white font-bold text-lg" dangerouslySetInnerHTML={{ __html: message }}></p>
                            {subMessage && <p className="text-zinc-400 text-xs mt-2 font-medium">{subMessage}</p>}
                        </div>
                    </div>
                </div>
            );
        }

        // --- Views using NexusBot ---

        function MaintenanceView({ onAdminLogin, accentColor }) {
            const [showAuth, setShowAuth] = useState(false);
            const [userLogin, setUserLogin] = useState('');
            const [passLogin, setPassLogin] = useState('');
            
            const tryLogin = () => { 
                if (userLogin === 'DN' && passLogin === 'dnvy2205ZX@') onAdminLogin(true); 
                else alert('Acesso negado'); 
            };

            return (
                <div className="fixed inset-0 z-[999] bg-black flex flex-col items-center justify-center p-8 text-center animate-fade-in text-white">
                    <NexusBot
                        mode="maintenance"
                        accentColor={accentColor}
                        message={`<span style="color: ${accentColor}">Manuten√ß√£o</span> em Andamento`}
                        subMessage="Estamos melhorando a experi√™ncia Nexus. Volte logo!"
                    />
                    
                    <div className="fixed bottom-10 w-full flex flex-col items-center gap-4">
                        {showAuth && (
                            <div className="animate-slide-up bg-zinc-900 border border-zinc-800 p-2 rounded-xl flex flex-col gap-2 w-64 shadow-2xl">
                                <input type="text" placeholder="Usu√°rio" className="bg-transparent text-white text-xs font-bold outline-none border-b border-zinc-700 py-1" value={userLogin} onChange={e => setUserLogin(e.target.value)} />
                                <div className="flex gap-2">
                                    <input type="password" placeholder="Senha" className="bg-transparent text-white text-xs font-bold outline-none flex-1" value={passLogin} onChange={e => setPassLogin(e.target.value)} />
                                    <button type="button" onClick={tryLogin} style={{backgroundColor: accentColor}} className="p-1.5 rounded-lg text-white active:scale-95 transition-all"><Icon name="ArrowRight" size={12} /></button>
                                </div>
                            </div>
                        )}
                        <div onClick={() => setShowAuth(!showAuth)} className="opacity-5 hover:opacity-100 transition-opacity cursor-pointer p-2"><span className="text-xl">üçã</span></div>
                    </div>
                </div>
            );
        }

        function NoticePopup({ config, onClose, accentColor }) {
            if (!config || !config.active) return null;
            return (
                <div className="fixed inset-0 z-[8000] bg-black/80 backdrop-blur-md flex items-center justify-center p-6 animate-fade-in">
                     <div className="relative w-full max-w-sm">
                        <NexusBot
                            mode="notice"
                            accentColor={accentColor}
                            message={config.title}
                            subMessage={config.message}
                        />
                        <button onClick={onClose} style={{backgroundColor: accentColor}} className="mt-8 w-full py-3.5 rounded-2xl font-bold text-white text-sm shadow-lg active:scale-95 transition-transform animate-scale-in">Entendido</button>
                     </div>
                </div>
            );
        }

        function IOSSwitch({ checked, onChange }) {
            return (
                <div 
                    onClick={() => onChange(!checked)}
                    className={`relative w-[50px] h-[30px] rounded-full transition-all duration-300 cursor-pointer ${checked ? 'bg-[#34C759]' : 'bg-[#39393D]'}`}
                >
                    <div className={`absolute top-[2px] w-[26px] h-[26px] bg-white rounded-full shadow-md transition-all duration-300 ${checked ? 'left-[22px]' : 'left-[2px]'}`}></div>
                </div>
            );
        }

        function InputField({ label, value, onChange, type = "text", placeholder = "", themeMode, accentColor }) {
            const colors = THEMES[themeMode] || THEMES.amoled;
            return (
                <div className="mb-4 w-full text-left">
                    <label className={`block text-[10px] font-bold mb-2 uppercase tracking-wide ml-1 ${colors.subtext}`}>{label}</label>
                    <input 
                        type={type} 
                        value={value} 
                        onChange={(e) => onChange(e.target.value)} 
                        placeholder={placeholder}
                        className={`w-full rounded-xl px-4 py-3 ${colors.input} ${colors.text} placeholder:opacity-50 ${themeMode === 'light' ? 'border border-gray-200' : 'border border-white/5'} outline-none font-medium text-sm transition-all focus:border-[${accentColor}] focus:ring-1 focus:ring-[${accentColor}]`}
                        style={{ caretColor: accentColor }}
                    />
                </div>
            );
        }

        function TabButton({ active, icon, label, onClick, themeMode, accentColor }) {
            const colors = THEMES[themeMode] || THEMES.amoled;
            return (
                <button onClick={onClick} className="flex flex-col items-center justify-center flex-1 gap-1 active:scale-90 outline-none transition-all group pt-1">
                    <div className={`transition-all duration-300`} style={{ color: active ? accentColor : undefined }} className={!active ? colors.subtext : ''}>
                        <Icon name={icon} size={24} />
                    </div>
                    {active && <span className="w-1 h-1 rounded-full absolute bottom-1.5 transition-all animate-scale-in" style={{ backgroundColor: accentColor }}></span>}
                </button>
            );
        }

        function PlatformBadge({ type }) {
            const isPC = type === 'PC';
            return (
                <span className={`text-[9px] font-bold uppercase tracking-wider px-1.5 py-[2px] rounded-[4px] border ml-1.5 opacity-90 ${isPC ? 'text-purple-400 border-purple-500/30 bg-purple-500/10' : 'text-emerald-400 border-emerald-500/30 bg-emerald-500/10'}`}>
                    {isPC ? 'PC' : 'MB'}
                </span>
            );
        }

        function VideoPlayer({ url, image }) {
            const ytId = useMemo(() => getYouTubeID(url), [url]);
            const handleTimeUpdate = (e) => { if (e.target.currentTime >= 60) { e.target.currentTime = 0; e.target.play().catch(() => {}); } };
            if (!url) return <img src={image} className="absolute inset-0 w-full h-full object-cover transition-opacity duration-500" />;
            if (ytId) {
                return (
                    <div className="absolute inset-0 bg-black overflow-hidden rounded-[inherit]">
                        <iframe src={`https://www.youtube.com/embed/${ytId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${ytId}&end=60&playsinline=1&showinfo=0&rel=0&iv_load_policy=3&modestbranding=1&enablejsapi=1`} className="absolute inset-0 w-full h-full object-cover yt-iframe" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
                        <div className="absolute inset-0 bg-transparent z-10"></div>
                    </div>
                );
            }
            return <video src={url} poster={image} autoPlay loop muted playsInline className="absolute inset-0 w-full h-full object-cover" onTimeUpdate={handleTimeUpdate} />;
        }

        function Toast({ title, body, icon, onClose, themeMode }) {
            const colors = THEMES[themeMode] || THEMES.amoled;
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            return (
                <div className={`fixed top-4 left-4 right-4 z-[9999] animate-toast-in flex items-center gap-3 p-3 rounded-2xl ${colors.card} border ${colors.border} shadow-2xl shadow-black/50 backdrop-blur-md cursor-pointer`} onClick={onClose}>
                    <img src={icon || "https://cdn-icons-png.flaticon.com/512/5726/5726678.png"} className="w-10 h-10 rounded-xl bg-zinc-800 object-cover" />
                    <div className="flex-1 min-w-0">
                        <h4 className={`text-sm font-bold ${colors.text}`}>{title}</h4>
                        <p className={`text-xs ${colors.subtext} truncate`}>{body}</p>
                    </div>
                </div>
            );
        }

        function AppListItem({ app, onClick, isAdmin, onEdit, lockedAppId, now, themeMode, accentColor }) {
            const colors = THEMES[themeMode] || THEMES.amoled;
            const isPreOrder = app.scheduledAt && now < app.scheduledAt;
            const unlockTime = app.unlockSurpriseAt || app.scheduledAt;
            const isEffectiveLocked = app.isLocked && (!unlockTime || now < unlockTime);
            
            const handleQuickDownload = (e) => {
                e.stopPropagation();
                if (isPreOrder) return;
                openSystemLink(app.downloadUrl);
            };

            return (
                <div onClick={onClick} className={`flex items-center gap-4 py-3 active:opacity-70 rounded-2xl -mx-3 px-3 transition-colors cursor-pointer group relative`}>
                    <div className="relative shrink-0">
                        {isEffectiveLocked ? (
                            <div className={`w-[60px] h-[60px] rounded-[14px] ${colors.card} flex items-center justify-center border ${colors.border} shadow-inner`}>
                                <span className={`text-2xl font-black ${colors.subtext}`}>?</span>
                            </div>
                        ) : (
                            <img src={app.icon} className="w-[60px] h-[60px] app-icon object-cover bg-zinc-800" />
                        )}
                        {lockedAppId === app.id && (
                            <div className="absolute inset-0 bg-black/60 rounded-[14px] flex items-center justify-center animate-fade-in z-20 backdrop-blur-[1px]">
                                <div className="animate-shake text-white"><Icon name="Lock" size={20} /></div>
                            </div>
                        )}
                    </div>
                    
                    <div className={`flex-1 min-w-0 flex flex-col justify-center h-full border-b ${colors.border} pb-3 group-last:border-none pt-1`}>
                        <div className="flex justify-between items-center">
                            <div className="flex-1 min-w-0 pr-3">
                                <h4 className={`font-semibold text-[15px] leading-tight truncate mb-0.5 ${colors.text} ${isEffectiveLocked ? 'opacity-50' : ''}`}>
                                    {isEffectiveLocked ? "Confidencial" : app.name}
                                    {app.isMod && !isEffectiveLocked && <span style={{color: accentColor, backgroundColor: `${accentColor}20`}} className="ml-1.5 text-[9px] px-1 py-0.5 rounded font-bold align-middle tracking-wider">MOD</span>}
                                </h4>
                                <p className={`text-[12px] font-medium truncate ${colors.subtext}`}>
                                    {isEffectiveLocked ? "Em breve..." : app.category}
                                </p>
                            </div>
                            
                            <div className="flex flex-col items-end gap-1 shrink-0">
                                <button 
                                    onClick={handleQuickDownload}
                                    style={{ color: isPreOrder ? undefined : accentColor, backgroundColor: isPreOrder ? undefined : (themeMode === 'light' ? `${accentColor}15` : `${accentColor}20`) }}
                                    className={`btn-get px-4 py-1.5 text-[10px] flex items-center gap-1.5 ${isPreOrder ? `bg-zinc-800 text-zinc-500 opacity-50 cursor-not-allowed` : ''}`}>
                                    <Icon name="Download" size={12} strokeWidth={3} />
                                    {isPreOrder ? 'AGUARDE' : 'OBTER'}
                                </button>
                                <div className="flex items-center justify-end w-full pr-1">
                                    {isPreOrder && <span className={`text-[9px] font-bold uppercase mr-1 ${colors.subtext}`}>{formatShortDate(app.scheduledAt)}</span>}
                                    <PlatformBadge type={app.platform} />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // --- Views ---

        function TodayView({ apps, highlights, onProfile, onSettings, onApp, isAdmin, profileImage, themeMode, accentColor }) {
            const now = Date.now();
            const colors = THEMES[themeMode] || THEMES.amoled;
            const [lockedAppId, setLockedAppId] = useState(null);
            
            const filteredHighlights = highlights.filter(h => {
                if(h.isHidden) return false;
                const isLive = !h.scheduledAt || now >= h.scheduledAt;
                const isPaused = h.removedAt && now >= h.removedAt && (!h.reactivatedAt || now < h.reactivatedAt);
                if(!isLive || isPaused) return false;
                if(h.recurringDays?.length > 0) { if(!h.recurringDays.includes(new Date().getDay())) return false; }
                return true;
            });

            const comingSoonApps = apps.filter(a => a.scheduledAt && now < a.scheduledAt && a.isVisibleBeforeLaunch).sort((a,b) => a.scheduledAt - b.scheduledAt).slice(0, 3);
            const releasedApps = apps.filter(a => !a.scheduledAt || now >= a.scheduledAt);

            const handleAppClick = (app) => {
                const unlockTime = app.unlockSurpriseAt || app.scheduledAt;
                const isEffectiveLocked = app.isLocked && (!unlockTime || now < unlockTime);
                if (isEffectiveLocked) { setLockedAppId(app.id); setTimeout(() => setLockedAppId(null), 1000); return; }
                onApp(app);
            };

            return (
                <div className={`view-animate ${colors.bg} min-h-screen pb-40 transition-colors duration-300 relative`}>
                    <header className={`pt-14 px-5 pb-4 flex justify-between items-center sticky top-0 z-20 backdrop-blur-xl ${colors.glass} transition-colors duration-300`}>
                        <div>
                            <p className={`text-[11px] font-bold ${colors.subtext} uppercase tracking-wide mb-0.5`}>{new Date().toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
                            <h1 className={`text-3xl font-extrabold tracking-tight ${colors.text}`}>Hoje</h1>
                        </div>
                        <div className="flex items-center gap-3">
                            {isAdmin && (
                                <button onClick={onSettings} className={`w-9 h-9 rounded-full flex items-center justify-center ${colors.input} border ${colors.border} active:scale-95 transition-transform`}>
                                    <Icon name="Settings" size={18} className={colors.text} />
                                </button>
                            )}
                            <button onClick={onProfile} className={`w-9 h-9 rounded-full overflow-hidden ${colors.input} border ${colors.border} shadow-sm active:scale-95 transition-transform`}>
                                {profileImage ? <img src={profileImage} className="w-full h-full object-cover" /> : <Icon name="User" size={20} className="text-zinc-500 m-auto mt-2" />}
                            </button>
                        </div>
                    </header>

                    <div className="space-y-10 px-5 pt-2">
                        <div className="flex overflow-x-auto gap-4 no-scrollbar -mx-5 px-5 snap-x snap-mandatory">
                            {filteredHighlights.map(h => (
                                <div key={h.id} className={`snap-center shrink-0 w-[85vw] max-w-[340px] aspect-[4/5] overflow-hidden relative shadow-ios cursor-pointer active:scale-98 transition-transform ${h.type === 'mosaic' ? 'bg-transparent shadow-none' : `${colors.card} rounded-[32px]`}`} onClick={() => h.type !== 'mosaic' && h.appId && onApp(apps.find(a => a.id === h.appId))}>
                                    {h.type === 'mosaic' ? (
                                        <div className="flex flex-col gap-2 h-full">
                                            <div className="w-full h-[55%] rounded-[24px] overflow-hidden relative shadow-lg" onClick={(e) => { e.stopPropagation(); h.items && h.items[0].appId && onApp(apps.find(a => a.id === h.items[0].appId)) }}>
                                                <img src={h.items[0].image} className="w-full h-full object-cover" />
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent p-4 flex flex-col justify-end">
                                                    <p className="text-[9px] font-bold text-zinc-300 uppercase tracking-widest shadow-black drop-shadow-md">{h.items[0].subtitle}</p>
                                                    <h3 className="text-xl font-extrabold text-white uppercase leading-none drop-shadow-lg">{h.items[0].title}</h3>
                                                </div>
                                            </div>
                                            <div className="flex gap-2 w-full h-[45%]">
                                                {[1, 2].map(idx => (
                                                    <div key={idx} className="flex-1 rounded-[24px] overflow-hidden relative shadow-lg" onClick={(e) => { e.stopPropagation(); h.items && h.items[idx].appId && onApp(apps.find(a => a.id === h.items[idx].appId)) }}>
                                                        <img src={h.items[idx].image} className="w-full h-full object-cover" />
                                                        <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent p-3 flex flex-col justify-end">
                                                            <p className="text-[8px] font-bold text-zinc-300 uppercase tracking-widest shadow-black drop-shadow-md">{h.items[idx].subtitle}</p>
                                                            <h4 className="text-sm font-extrabold text-white uppercase leading-none drop-shadow-lg">{h.items[idx].title}</h4>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <VideoPlayer url={h.videoUrl} image={h.image} />
                                            <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent p-8 flex flex-col justify-end">
                                                <p className="text-[10px] font-bold text-zinc-300 uppercase tracking-widest mb-2 shadow-black drop-shadow-md">{h.subtitle}</p>
                                                <h2 className="text-4xl font-extrabold text-white uppercase leading-none drop-shadow-lg tracking-tight">{h.title}</h2>
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>

                        {comingSoonApps.length > 0 && (
                            <section>
                                <div className={`flex items-center justify-between mb-4 border-b ${colors.border} pb-2`}>
                                    <h3 className="text-xl font-bold" style={{color: accentColor}}>Em Breve</h3>
                                    <span className={`text-xs font-medium ${colors.subtext}`}>Pr√©-venda</span>
                                </div>
                                <div className="space-y-1">
                                    {comingSoonApps.map(app => <AppListItem key={app.id} app={app} onClick={() => handleAppClick(app)} isAdmin={isAdmin} lockedAppId={lockedAppId} now={now} themeMode={themeMode} accentColor={accentColor} />)}
                                </div>
                            </section>
                        )}

                        {Array.from(new Set(releasedApps.map(a => a.category))).map(cat => (
                            <section key={cat}>
                                <h3 className={`text-xl font-bold mb-4 ${colors.text} border-b ${colors.border} pb-2`}>{cat}</h3>
                                <div className="space-y-1">
                                    {releasedApps.filter(a => a.category === cat).map(app => <AppListItem key={app.id} app={app} onClick={() => handleAppClick(app)} isAdmin={isAdmin} lockedAppId={lockedAppId} now={now} themeMode={themeMode} accentColor={accentColor} />)}
                                </div>
                            </section>
                        ))}
                    </div>
                </div>
            );
        }

        // --- Other Views ---
        function SearchView({ apps, onApp, onProfile, profileImage, themeMode, accentColor }) {
            const [query, setQuery] = useState('');
            const [lockedAppId, setLockedAppId] = useState(null);
            const now = Date.now();
            const colors = THEMES[themeMode] || THEMES.amoled;
            const filtered = apps.filter(a => {
                const isReleased = !a.scheduledAt || now >= a.scheduledAt;
                const matches = a.name.toLowerCase().includes(query.toLowerCase());
                return matches && (isReleased || a.isVisibleBeforeLaunch);
            });
            const handleAppClick = (app) => {
                const unlockTime = app.unlockSurpriseAt || app.scheduledAt;
                const isEffectiveLocked = app.isLocked && (!unlockTime || now < unlockTime);
                if (isEffectiveLocked) { setLockedAppId(app.id); setTimeout(() => setLockedAppId(null), 1000); return; }
                onApp(app);
            };
            return (
                <div className={`view-animate ${colors.bg} min-h-screen transition-colors duration-300`}>
                    <header className={`pt-14 px-5 pb-4 flex justify-between items-end sticky top-0 z-20 border-b ${colors.border} backdrop-blur-xl ${colors.glass} transition-colors duration-300`}>
                        <h1 className={`text-3xl font-extrabold tracking-tight ${colors.text}`}>Busca</h1>
                        <button onClick={onProfile} className={`w-9 h-9 rounded-full overflow-hidden ${colors.input} border ${colors.border}`}>
                            {profileImage ? <img src={profileImage} className="w-full h-full object-cover" /> : <Icon name="User" size={20} className={`text-zinc-500 m-auto mt-2`} />}
                        </button>
                    </header>
                    <div className="px-5 pt-2 pb-40">
                        <div className="relative mb-6">
                            <Icon name="Search" size={18} className="absolute left-3 top-3 text-zinc-500" />
                            <input className={`w-full ${colors.input} ${colors.text} rounded-xl pl-10 pr-4 py-2.5 text-[15px] outline-none placeholder:text-zinc-500 font-medium transition-colors duration-300`} placeholder="Jogos, Apps, Hist√≥rias..." value={query} onChange={(e) => setQuery(e.target.value)} />
                        </div>
                        <div className="space-y-1">
                            {filtered.length === 0 ? <p className={`text-center ${colors.subtext} mt-10 font-medium`}>Nenhum resultado.</p> : filtered.map(app => <AppListItem key={app.id} app={app} onClick={() => handleAppClick(app)} lockedAppId={lockedAppId} now={now} themeMode={themeMode} accentColor={accentColor} />)}
                        </div>
                    </div>
                </div>
            );
        }

        function GenericTabView({ title, apps, onApp, isAdmin, themeMode, accentColor }) {
            const now = Date.now();
            const colors = THEMES[themeMode] || THEMES.amoled;
            const visibleApps = apps.filter(a => (!a.scheduledAt || now >= a.scheduledAt) || a.isVisibleBeforeLaunch);
            const [lockedAppId, setLockedAppId] = useState(null);
            const handleAppClick = (app) => {
                const unlockTime = app.unlockSurpriseAt || app.scheduledAt;
                const isEffectiveLocked = app.isLocked && (!unlockTime || now < unlockTime);
                if (isEffectiveLocked) { setLockedAppId(app.id); setTimeout(() => setLockedAppId(null), 1000); return; }
                onApp(app);
            };
            return (
                <div className={`view-animate ${colors.bg} min-h-screen transition-colors duration-300`}>
                    <header className={`pt-14 px-5 pb-6 sticky top-0 z-20 border-b ${colors.border} backdrop-blur-xl ${colors.glass} transition-colors duration-300`}>
                        <h1 className={`text-3xl font-extrabold tracking-tight ${colors.text}`}>{title}</h1>
                    </header>
                    <div className="px-5 pt-2 pb-40 space-y-1">
                        {visibleApps.map(app => <AppListItem key={app.id} app={app} onClick={() => handleAppClick(app)} isAdmin={isAdmin} lockedAppId={lockedAppId} now={now} themeMode={themeMode} accentColor={accentColor} />)}
                        {visibleApps.length === 0 && <div className={`text-center ${colors.subtext} mt-20`}>Vazio</div>}
                    </div>
                </div>
            );
        }

        // --- NEW Settings Modal (Consolidated Admin) ---
        function SettingsModal({ onClose, accentColor, themeMode, onAddApp, onAddStory, onSchedule, maintenance, toggleMaintenance, noticeConfig, setNoticeConfig }) {
            const colors = THEMES[themeMode] || THEMES.amoled;
            const [savingNotice, setSavingNotice] = useState(false);

            const saveNotice = async () => {
                setSavingNotice(true);
                await db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('config').set({ notice: noticeConfig }, { merge: true });
                setSavingNotice(false);
                alert("Aviso Global Atualizado!");
            };

            return (
                <div className={`fixed inset-0 z-[200] ${colors.bg} view-animate flex flex-col`}>
                     <header className={`px-5 pt-14 pb-4 flex justify-between items-center border-b ${colors.border}`}>
                        <h1 className={`text-3xl font-extrabold tracking-tight ${colors.text}`}>Configura√ß√µes</h1>
                        <button onClick={onClose} style={{color: accentColor}} className={`w-9 h-9 rounded-full flex items-center justify-center font-bold ${colors.input}`}><Icon name="X" size={20} /></button>
                     </header>
                     <div className="flex-1 overflow-y-auto p-5 space-y-8 pb-20">
                         
                         {/* Conte√∫do */}
                         <section>
                             <h3 className={`text-xs font-bold uppercase tracking-wider mb-3 ${colors.subtext} ml-2`}>Gerenciar Conte√∫do</h3>
                             <div className={`rounded-2xl overflow-hidden ${colors.input}`}>
                                 <div onClick={onAddApp} className={`p-4 flex items-center justify-between border-b ${colors.border} active:bg-white/5 cursor-pointer`}>
                                     <div className="flex items-center gap-3"><Icon name="PlusSquare" className={colors.text} size={20} /><span className={`font-medium ${colors.text}`}>Adicionar App</span></div>
                                     <Icon name="ChevronRight" className={colors.subtext} size={16} />
                                 </div>
                                 <div onClick={onAddStory} className={`p-4 flex items-center justify-between border-b ${colors.border} active:bg-white/5 cursor-pointer`}>
                                     <div className="flex items-center gap-3"><Icon name="PlayCircle" className={colors.text} size={20} /><span className={`font-medium ${colors.text}`}>Novo Story</span></div>
                                     <Icon name="ChevronRight" className={colors.subtext} size={16} />
                                 </div>
                                 <div onClick={onSchedule} className={`p-4 flex items-center justify-between active:bg-white/5 cursor-pointer`}>
                                     <div className="flex items-center gap-3"><Icon name="Clock" className={colors.text} size={20} /><span className={`font-medium ${colors.text}`}>Cronograma & Edi√ß√£o</span></div>
                                     <Icon name="ChevronRight" className={colors.subtext} size={16} />
                                 </div>
                             </div>
                         </section>

                         {/* Sistema */}
                         <section>
                             <h3 className={`text-xs font-bold uppercase tracking-wider mb-3 ${colors.subtext} ml-2`}>Sistema</h3>
                             <div className={`rounded-2xl overflow-hidden ${colors.input}`}>
                                 <div className={`p-4 flex items-center justify-between`}>
                                     <div className="flex items-center gap-3"><Icon name="AlertOctagon" className={colors.text} size={20} /><span className={`font-medium ${colors.text}`}>Modo Manuten√ß√£o</span></div>
                                     <IOSSwitch checked={maintenance} onChange={toggleMaintenance} />
                                 </div>
                             </div>
                         </section>

                         {/* Aviso Global */}
                         <section>
                             <h3 className={`text-xs font-bold uppercase tracking-wider mb-3 ${colors.subtext} ml-2`}>Aviso Global (P√≥s-Rob√¥)</h3>
                             <div className={`p-4 rounded-2xl ${colors.input} space-y-4`}>
                                 <div className="flex justify-between items-center mb-2">
                                     <span className={`text-sm font-bold ${colors.text}`}>Ativar Aviso</span>
                                     <IOSSwitch checked={noticeConfig.active} onChange={v => setNoticeConfig({...noticeConfig, active: v})} />
                                 </div>
                                 <input type="text" placeholder="T√≠tulo do Aviso" value={noticeConfig.title} onChange={e => setNoticeConfig({...noticeConfig, title: e.target.value})} className={`w-full bg-black/20 rounded-lg p-2 text-sm ${colors.text} outline-none border border-transparent focus:border-[${accentColor}]`} />
                                 <textarea rows="3" placeholder="Mensagem do aviso..." value={noticeConfig.message} onChange={e => setNoticeConfig({...noticeConfig, message: e.target.value})} className={`w-full bg-black/20 rounded-lg p-2 text-sm ${colors.text} outline-none border border-transparent focus:border-[${accentColor}]`} />
                                 <button onClick={saveNotice} style={{backgroundColor: accentColor}} className="w-full py-3 rounded-xl font-bold text-white text-sm shadow-md active:scale-95 transition-transform">{savingNotice ? 'Salvando...' : 'Atualizar Aviso'}</button>
                             </div>
                         </section>
                     </div>
                </div>
            );
        }

        // --- Modals (AdminApp, Highlight, Profile, etc.) ---
        
        function ScheduledView({ apps, highlights, onClose, onEditApp, onEditHigh, accentColor }) {
            const now = Date.now();
            const allApps = [...apps].sort((a,b) => (a.scheduledAt || 0) - (b.scheduledAt || 0));
            const allHighs = [...highlights].sort((a,b) => (a.createdAt || 0) - (b.createdAt || 0));

            return (
                <div className="fixed inset-0 z-[300] bg-black text-white animate-slide-up flex flex-col overflow-y-auto">
                    <header className="h-14 flex items-center justify-between px-4 sticky top-0 bg-black/80 backdrop-blur-xl border-b border-zinc-800 z-30">
                        <button onClick={onClose} style={{color: accentColor}} className="font-bold flex items-center gap-1 text-sm"><Icon name="ChevronLeft" size={20} /> Voltar</button>
                        <h2 className="text-sm font-bold text-zinc-400 uppercase tracking-widest">Cronograma</h2>
                        <div className="w-10"></div>
                    </header>
                    <div className="p-6 space-y-10 pb-20 max-w-4xl mx-auto w-full">
                        <section>
                            <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-white"><Icon name="Clock" style={{color: accentColor}} size={18} /> Todos os Stories</h3>
                            <div className="space-y-3">
                                {allHighs.map(h => (
                                    <div key={h.id} onClick={() => onEditHigh(h)} className="flex items-center gap-4 p-3 rounded-2xl bg-zinc-900 border border-zinc-800 active:scale-98 transition-transform">
                                        <img src={h.image || h.items?.[0]?.image} className="w-10 h-14 rounded-lg object-cover bg-zinc-800" />
                                        <div className="flex-1 min-w-0">
                                            <p className="font-bold text-sm truncate text-white mb-1">{h.title || h.items?.[0]?.title}</p>
                                            <span style={{color: accentColor, backgroundColor: `${accentColor}15`}} className="text-[9px] px-1.5 py-0.5 rounded uppercase font-bold">{h.layout === 'mosaic' ? 'Mosaico' : 'Cl√°ssico'}</span>
                                        </div>
                                        <Icon name="Edit3" size={16} className="text-zinc-600" />
                                    </div>
                                ))}
                            </div>
                        </section>
                        <section>
                            <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-white"><Icon name="Rocket" style={{color: accentColor}} size={18} /> Todos os Apps</h3>
                            <div className="space-y-3">
                                {allApps.map(app => (
                                    <div key={app.id} onClick={() => onEditApp(app)} className="flex items-center gap-4 p-3 rounded-2xl bg-zinc-900 border border-zinc-800 active:scale-98 transition-transform">
                                        <img src={app.icon} className="w-10 h-10 rounded-xl object-cover bg-zinc-800" />
                                        <div className="flex-1 min-w-0">
                                            <p className="font-bold text-sm truncate text-white mb-1">{app.name}</p>
                                            <p className="text-[10px] text-zinc-500">{app.category}</p>
                                        </div>
                                        <Icon name="Edit3" size={16} className="text-zinc-600" />
                                    </div>
                                ))}
                            </div>
                        </section>
                    </div>
                </div>
            );
        }

        // RESTORED AdminAppModal
        function AdminAppModal({ editingApp, onClose, accentColor }) {
            const [form, setForm] = useState({});
            const [loading, setLoading] = useState(false);
            
            useEffect(() => {
                const base = { name: '', developer: '', version: '', icon: '', category: 'Apps', screenshots: [], downloadUrl: '', uploadDate: '', updateDate: '', description: '', rating: '4+', updateNews: '', isMod: false, scheduledAt: '', isVisibleBeforeLaunch: false, hasWarning: false, warningMessage: '', platform: 'Mobile', isLocked: false, unlockSurpriseAt: '' };
                if (editingApp) {
                    setForm({ ...base, ...editingApp, screenshots: editingApp.screenshots || [], scheduledAt: toLocalDatetimeString(editingApp.scheduledAt), unlockSurpriseAt: toLocalDatetimeString(editingApp.unlockSurpriseAt) });
                } else setForm(base);
            }, [editingApp]);

            const handleFile = (e, field) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setForm(prev => ({...prev, [field]: reader.result}));
                    reader.readAsDataURL(file);
                }
            };
            
             const handleScreenshots = (e) => {
                const files = Array.from(e.target.files);
                Promise.all(files.map(file => new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                }))).then(results => {
                     setForm(prev => ({...prev, screenshots: [...(prev.screenshots || []), ...results]}));
                });
            };
            
            const save = async () => {
                if (!form.name || !form.icon) return alert("T√≠tulo e √çcone obrigat√≥rios.");
                setLoading(true);
                const payload = { ...form, screenshots: form.screenshots, scheduledAt: form.scheduledAt ? new Date(form.scheduledAt).getTime() : null, unlockSurpriseAt: form.unlockSurpriseAt ? new Date(form.unlockSurpriseAt).getTime() : null };
                delete payload.id;
                try {
                    const coll = db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('data').collection('apps');
                    if (editingApp?.id) await coll.doc(editingApp.id).update(payload); else await coll.add(payload);
                    onClose();
                } catch (e) { alert(e.message); } finally { setLoading(false); }
            };

            return (
                <div className="fixed inset-0 z-[150] bg-black text-white animate-slide-up flex flex-col overflow-y-auto">
                    <header className="flex justify-between items-center p-4 sticky top-0 bg-black/90 backdrop-blur-md border-b border-zinc-800 z-10"><h2 className="text-lg font-bold">Editar App</h2><button onClick={onClose}><Icon name="X" size={24} /></button></header>
                    <div className="p-6 space-y-5 max-w-xl mx-auto w-full pb-20">
                        <InputField label="Nome" value={form.name} onChange={v => setForm({...form, name: v})} accentColor={accentColor} />
                        <InputField label="Desenvolvedor" value={form.developer} onChange={v => setForm({...form, developer: v})} accentColor={accentColor} />
                        
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-zinc-900 p-3 rounded-xl border border-zinc-800 flex items-center justify-between">
                                <span className="text-xs font-bold">MOD?</span>
                                <input type="checkbox" checked={form.isMod} onChange={e => setForm({...form, isMod: e.target.checked})} className="w-4 h-4" />
                            </div>
                            <InputField label="Agendar" type="datetime-local" value={form.scheduledAt} onChange={v => setForm({...form, scheduledAt: v})} accentColor={accentColor} />
                        </div>

                        <div className="space-y-1"><label className="text-[10px] font-bold text-zinc-500 uppercase ml-1">Plataforma</label>
                            <div className="flex gap-2">
                                <button onClick={() => setForm({...form, platform: 'Mobile'})} style={{backgroundColor: form.platform === 'Mobile' ? accentColor : '', borderColor: form.platform === 'Mobile' ? accentColor : ''}} className={`flex-1 py-2 rounded-lg text-xs font-bold border ${form.platform === 'Mobile' ? 'text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500'}`}>Mobile</button>
                                <button onClick={() => setForm({...form, platform: 'PC'})} style={{backgroundColor: form.platform === 'PC' ? accentColor : '', borderColor: form.platform === 'PC' ? accentColor : ''}} className={`flex-1 py-2 rounded-lg text-xs font-bold border ${form.platform === 'PC' ? 'text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500'}`}>PC</button>
                            </div>
                        </div>

                        <div className="bg-zinc-900 p-4 rounded-2xl border border-zinc-800 flex items-center justify-between">
                            <div><p className="text-sm font-bold" style={{color: accentColor}}>Exibir na Loja (Pr√©-venda)</p><p className="text-[10px] text-zinc-500">Mostra como "Em Breve" antes da data.</p></div>
                            <input type="checkbox" checked={form.isVisibleBeforeLaunch} onChange={e => setForm({...form, isVisibleBeforeLaunch: e.target.checked})} className="w-5 h-5 accent-blue-500" />
                        </div>

                        <div className="bg-zinc-900 p-4 rounded-2xl border border-purple-500/30 flex flex-col gap-3">
                            <div className="flex items-center justify-between">
                                <div><p className="text-sm font-bold text-purple-400 flex gap-2"><Icon name="Lock" size={14} /> Modo Surpresa</p><p className="text-[10px] text-zinc-500">Esconde detalhes at√© a data.</p></div>
                                <input type="checkbox" checked={form.isLocked} onChange={e => setForm({...form, isLocked: e.target.checked})} className="w-5 h-5 accent-purple-500" />
                            </div>
                            {form.isLocked && <InputField label="Data Revela√ß√£o (Opcional)" type="datetime-local" value={form.unlockSurpriseAt} onChange={v => setForm({...form, unlockSurpriseAt: v})} accentColor={accentColor} />}
                        </div>

                        <div className="bg-zinc-900 p-4 rounded-2xl border border-yellow-500/20 space-y-2">
                            <div className="flex justify-between items-center"><span className="text-sm font-bold text-yellow-500">Aviso Pr√©vio</span><input type="checkbox" checked={form.hasWarning} onChange={e => setForm({...form, hasWarning: e.target.checked})} className="w-4 h-4 accent-yellow-500" /></div>
                            {form.hasWarning && <textarea className="w-full bg-black/50 p-2 rounded-lg text-xs text-white border border-zinc-700 outline-none" rows="3" value={form.warningMessage} onChange={e => setForm({...form, warningMessage: e.target.value})} placeholder="Mensagem de alerta..." />}
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <InputField label="Vers√£o" value={form.version} onChange={v => setForm({...form, version: v})} accentColor={accentColor} />
                            <div className="space-y-1"><label className="text-[10px] font-bold text-zinc-500 uppercase ml-1">Categoria</label>
                                <select className="w-full bg-zinc-900 text-white rounded-xl p-3 text-sm font-medium border border-zinc-800 outline-none" value={form.category} onChange={e => setForm({...form, category: e.target.value})}>
                                    {['Apps', 'Jogos', 'PC', 'Streaming', 'Utilit√°rios', 'Rede Sociais'].map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                        </div>
                        
                        <div>
                             <InputField label="√çcone URL" value={form.icon} onChange={v => setForm({...form, icon: v})} accentColor={accentColor} />
                             <div className="file-input-wrapper w-full bg-zinc-800 text-center py-2 rounded-lg text-xs font-bold text-zinc-400 mb-4 cursor-pointer hover:bg-zinc-700 transition">
                                 OU Carregar √çcone do Dispositivo
                                 <input type="file" accept="image/*" onChange={(e) => handleFile(e, 'icon')} />
                             </div>
                        </div>

                        <InputField label="Download URL" value={form.downloadUrl} onChange={v => setForm({...form, downloadUrl: v})} accentColor={accentColor} />
                        
                        <div>
                            <InputField label="Screenshots URLs (sep. v√≠rgula)" value={(form.screenshots || []).join(', ')} onChange={v => setForm({...form, screenshots: v.split(',').map(s => s.trim())})} accentColor={accentColor} />
                             <div className="file-input-wrapper w-full bg-zinc-800 text-center py-2 rounded-lg text-xs font-bold text-zinc-400 mb-4 cursor-pointer hover:bg-zinc-700 transition">
                                 OU Carregar Screenshots do Dispositivo
                                 <input type="file" accept="image/*" multiple onChange={handleScreenshots} />
                             </div>
                        </div>

                        <div className="space-y-1"><label className="text-[10px] font-bold text-zinc-500 uppercase ml-1">Descri√ß√£o</label><textarea className="w-full bg-zinc-900 text-white rounded-xl p-3 text-sm border border-zinc-800 outline-none" rows="4" value={form.description} onChange={e => setForm({...form, description: e.target.value})} /></div>

                        <div className="flex gap-4 pt-4">
                            {editingApp && <button onClick={() => { if(confirm('Deletar?')) db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('data').collection('apps').doc(editingApp.id).delete().then(onClose)}} className="p-4 bg-red-500/10 text-red-500 rounded-xl"><Icon name="Trash2" /></button>}
                            <button onClick={save} style={{backgroundColor: accentColor}} className="flex-1 text-white font-bold py-4 rounded-xl">{loading ? 'Salvando...' : 'Salvar App'}</button>
                        </div>
                    </div>
                </div>
            );
        }

        // RESTORED HighlightModal
        function HighlightModal({ editingHighlight, apps, onClose, accentColor }) {
            const [form, setForm] = useState({ layout: 'standard', items: [{}, {}, {}] });
            const [loading, setLoading] = useState(false);
            const weekDays = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
            const [mosaicTab, setMosaicTab] = useState(0); 
            
            useEffect(() => { 
                const base = { title: '', subtitle: '', image: '', videoUrl: '', appId: '', isTimed: false, createdAt: null, scheduledAt: '', removedAt: '', reactivatedAt: '', isHidden: false, recurringDays: [], layout: 'standard', items: [{}, {}, {}] };
                if (editingHighlight) {
                    const mergedItems = editingHighlight.items ? [...editingHighlight.items] : [{}, {}, {}];
                    while(mergedItems.length < 3) mergedItems.push({});
                    setForm({ ...base, ...editingHighlight, items: mergedItems, videoUrl: editingHighlight.videoUrl || '', scheduledAt: toLocalDatetimeString(editingHighlight.scheduledAt), removedAt: toLocalDatetimeString(editingHighlight.removedAt), reactivatedAt: toLocalDatetimeString(editingHighlight.reactivatedAt) }); 
                } else setForm(base);
            }, [editingHighlight]);
            
            const toggleDay = (i) => { const n = [...(form.recurringDays||[])]; if(n.includes(i)) setForm({...form, recurringDays: n.filter(d=>d!==i)}); else setForm({...form, recurringDays: [...n, i]}); };
            
            const updateItem = (index, field, val) => {
                const newItems = [...form.items];
                newItems[index] = { ...newItems[index], [field]: val };
                setForm({...form, items: newItems});
            };

            const save = async () => {
                if (form.layout === 'standard') {
                     if (!form.title || !form.image) return alert("T√≠tulo e Capa obrigat√≥rios.");
                } else {
                    if (!form.items[0].image || !form.items[1].image || !form.items[2].image) return alert("Todas as 3 imagens do mosaico s√£o obrigat√≥rias.");
                }
                
                setLoading(true);
                const now = Date.now();
                const data = { ...form, createdAt: form.isTimed && !form.createdAt ? now : (form.createdAt || now), scheduledAt: form.scheduledAt ? new Date(form.scheduledAt).getTime() : null, removedAt: form.removedAt ? new Date(form.removedAt).getTime() : null, reactivatedAt: form.reactivatedAt ? new Date(form.reactivatedAt).getTime() : null };
                try {
                    const coll = db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('data').collection('highlights');
                    if (editingHighlight?.id) await coll.doc(editingHighlight.id).update(data); else await coll.add(data);
                    onClose();
                } catch (e) { alert(e.message); } finally { setLoading(false); }
            };

            return (
                <div className="fixed inset-0 z-[150] bg-black text-white animate-slide-up flex flex-col overflow-y-auto">
                    <header className="flex justify-between items-center p-4 sticky top-0 bg-black/90 backdrop-blur-md border-b border-zinc-800 z-10"><h2 className="text-lg font-bold">Editar Story</h2><button onClick={onClose}><Icon name="X" size={24} /></button></header>
                    <div className="p-6 space-y-6 max-w-xl mx-auto w-full pb-20">
                        
                        <div className="space-y-1">
                            <label className="text-xs font-bold text-zinc-500 uppercase ml-1">Estilo do Layout</label>
                            <div className="flex gap-2">
                                <button onClick={() => setForm({...form, layout: 'standard'})} style={{backgroundColor: form.layout === 'standard' ? accentColor : '', borderColor: form.layout === 'standard' ? accentColor : ''}} className={`flex-1 py-3 rounded-xl border text-xs font-bold uppercase ${form.layout === 'standard' ? 'text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500'}`}>Cl√°ssico</button>
                                <button onClick={() => setForm({...form, layout: 'mosaic'})} style={{backgroundColor: form.layout === 'mosaic' ? accentColor : '', borderColor: form.layout === 'mosaic' ? accentColor : ''}} className={`flex-1 py-3 rounded-xl border text-xs font-bold uppercase ${form.layout === 'mosaic' ? 'text-white' : 'bg-zinc-900 border-zinc-800 text-zinc-500'}`}>Mosaico (3)</button>
                            </div>
                        </div>

                        {form.layout === 'standard' ? (
                            <>
                                <InputField label="T√≠tulo" value={form.title} onChange={v => setForm({...form, title: v})} accentColor={accentColor} />
                                <InputField label="Subt√≠tulo" value={form.subtitle} onChange={v => setForm({...form, subtitle: v})} accentColor={accentColor} />
                                <InputField label="Imagem URL" value={form.image} onChange={v => setForm({...form, image: v})} accentColor={accentColor} />
                                <InputField label="V√≠deo URL (Opcional)" value={form.videoUrl} onChange={v => setForm({...form, videoUrl: v})} accentColor={accentColor} />
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-zinc-500 uppercase ml-1">Vincular App</label>
                                    <select className="w-full bg-zinc-900 text-white rounded-xl p-3 text-sm font-medium border border-zinc-800 outline-none" value={form.appId} onChange={e => setForm({...form, appId: e.target.value})}>
                                        <option value="">Nenhum</option>
                                        {apps.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}
                                    </select>
                                </div>
                            </>
                        ) : (
                            <div className="bg-zinc-900/50 p-4 rounded-3xl border border-zinc-800">
                                <div className="flex mb-6 bg-zinc-900 rounded-xl p-1">
                                    {['Topo (Grande)', 'Inf. Esq.', 'Inf. Dir.'].map((label, idx) => (
                                        <button key={idx} onClick={() => setMosaicTab(idx)} className={`flex-1 py-2 rounded-lg text-[10px] font-bold uppercase transition-all ${mosaicTab === idx ? 'bg-zinc-700 text-white shadow' : 'text-zinc-500'}`}>{label}</button>
                                    ))}
                                </div>
                                <div className="space-y-4 animate-fade-in">
                                    <InputField label={`T√≠tulo (${mosaicTab === 0 ? 'Topo' : mosaicTab === 1 ? 'Esq' : 'Dir'})`} value={form.items[mosaicTab].title || ''} onChange={v => updateItem(mosaicTab, 'title', v)} accentColor={accentColor} />
                                    <InputField label="Subt√≠tulo" value={form.items[mosaicTab].subtitle || ''} onChange={v => updateItem(mosaicTab, 'subtitle', v)} accentColor={accentColor} />
                                    <InputField label="Imagem URL" value={form.items[mosaicTab].image || ''} onChange={v => updateItem(mosaicTab, 'image', v)} accentColor={accentColor} />
                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-zinc-500 uppercase ml-1">Vincular App</label>
                                        <select className="w-full bg-zinc-900 text-white rounded-xl p-3 text-sm font-medium border border-zinc-800 outline-none" value={form.items[mosaicTab].appId || ''} onChange={e => updateItem(mosaicTab, 'appId', e.target.value)}>
                                            <option value="">Nenhum</option>
                                            {apps.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div className="bg-zinc-900 p-4 rounded-2xl flex justify-between items-center border border-zinc-800">
                            <span className="text-sm font-bold text-red-400">Ocultar Manualmente</span>
                            <input type="checkbox" checked={form.isHidden} onChange={e => setForm({...form, isHidden: e.target.checked})} className="toggle-checkbox w-5 h-5 rounded accent-red-500" />
                        </div>

                        <div className="space-y-2">
                            <label className="text-xs font-bold text-zinc-500 uppercase">Recorr√™ncia Semanal</label>
                            <div className="flex gap-2">{weekDays.map((d, i) => <button key={i} onClick={() => toggleDay(i)} style={{backgroundColor: form.recurringDays?.includes(i) ? accentColor : undefined, color: form.recurringDays?.includes(i) ? 'white' : undefined}} className={`w-8 h-8 rounded-full text-xs font-bold ${!form.recurringDays?.includes(i) ? 'bg-zinc-800 text-zinc-500' : ''}`}>{d}</button>)}</div>
                        </div>

                        <div className="grid grid-cols-1 gap-3">
                            <InputField label="In√≠cio (Data/Hora)" type="datetime-local" value={form.scheduledAt} onChange={v => setForm({...form, scheduledAt: v})} accentColor={accentColor} />
                            <InputField label="Fim (Data/Hora)" type="datetime-local" value={form.removedAt} onChange={v => setForm({...form, removedAt: v})} accentColor={accentColor} />
                        </div>

                        <div className="flex gap-4 pt-4">
                            {editingHighlight && <button onClick={() => { if(confirm('Deletar?')) db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('data').collection('highlights').doc(editingHighlight.id).delete().then(onClose)}} className="p-4 bg-red-500/10 text-red-500 rounded-xl"><Icon name="Trash2" /></button>}
                            <button onClick={save} style={{backgroundColor: accentColor}} className="flex-1 text-white font-bold py-4 rounded-xl">{loading ? 'Salvando...' : 'Salvar'}</button>
                        </div>
                    </div>
                </div>
            );
        }

        // RESTORED LoginView
        function LoginView({ onLogin }) {
            const [mode, setMode] = useState('login'); // login | register
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);

            const handleAction = async (e) => {
                e.preventDefault();
                if (!username || !password) return alert('Preencha todos os campos.');
                setLoading(true);

                try {
                    if (mode === 'login' && username === 'DN' && password === 'dnvy2205ZX@') {
                        onLogin(true, username);
                        return;
                    }

                    const accountRef = db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('accounts').collection('users').doc(username);
                    const doc = await accountRef.get();

                    if (mode === 'login') {
                        if (doc.exists && doc.data().password === password) {
                            onLogin(false, username, doc.data().image);
                        } else {
                            alert("Usu√°rio ou senha incorretos.");
                        }
                    } else {
                        if (doc.exists) {
                            alert("Este usu√°rio j√° existe.");
                        } else {
                            await accountRef.set({ password: password, createdAt: Date.now(), image: '' });
                            alert("Conta criada com sucesso! Fa√ßa login.");
                            setMode('login');
                        }
                    }
                } catch (error) {
                    console.error(error);
                    alert("Erro ao processar. Tente novamente.");
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="h-screen bg-black flex flex-col items-center justify-center p-8 text-center animate-fade-in relative overflow-hidden">
                    <div className="absolute inset-0 bg-gradient-to-b from-blue-900/10 to-black z-0"></div>
                    <div className="w-full max-w-sm z-10 relative">
                        <div className="w-20 h-20 bg-zinc-900 rounded-[24px] flex items-center justify-center mx-auto mb-8 shadow-2xl border border-zinc-800">
                            <Icon name="Hexagon" size={40} className="text-blue-500" />
                        </div>
                        <h1 className="text-3xl font-black text-white mb-2 tracking-tight">{mode === 'login' ? 'Bem-vindo' : 'Criar Conta'}</h1>
                        <p className="text-zinc-500 text-sm font-medium mb-10">{mode === 'login' ? 'Entre na sua conta Nexus.' : 'Junte-se ao Nexus hoje.'}</p>
                        <form onSubmit={handleAction} className="space-y-4">
                            <div className="bg-zinc-900/50 border border-zinc-800 rounded-2xl p-1">
                                <input type="text" placeholder="Usu√°rio" className="w-full bg-transparent px-4 py-3 text-sm font-bold text-white outline-none placeholder:text-zinc-600" value={username} onChange={(e) => setUsername(e.target.value)} />
                                <div className="h-[1px] bg-zinc-800 mx-4"></div>
                                <input type="password" placeholder="Senha" className="w-full bg-transparent px-4 py-3 text-sm font-bold text-white outline-none placeholder:text-zinc-600" value={password} onChange={(e) => setPassword(e.target.value)} />
                            </div>
                            <button type="submit" disabled={loading} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold text-sm active:scale-95 transition-transform shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2">
                                {loading ? 'Processando...' : (mode === 'login' ? 'Entrar' : 'Cadastrar')}
                            </button>
                        </form>
                        <div className="mt-6">
                            <button onClick={() => setMode(mode === 'login' ? 'register' : 'login')} className="text-xs font-bold text-zinc-500 hover:text-white transition-colors">
                                {mode === 'login' ? 'N√£o tem uma conta? Criar agora' : 'J√° tem conta? Fazer Login'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // RESTORED AppDetail
        function AppDetail({ app, onClose, themeMode, accentColor }) {
            const now = Date.now();
            const colors = THEMES[themeMode] || THEMES.amoled;
            const isPreOrder = app.scheduledAt && now < app.scheduledAt;
            const [showWarning, setShowWarning] = useState(!!app.hasWarning);
            const isEffectiveLocked = app.isLocked && (!app.unlockSurpriseAt && (!app.scheduledAt || now < app.scheduledAt));

            const handleDownload = () => { if (isPreOrder) return; openSystemLink(app.downloadUrl); };
            
            const handleShare = async () => {
                const shareData = { title: app.name, text: `Confira ${app.name} na Nexus Store!`, url: app.downloadUrl || window.location.href };
                if (navigator.share) { try { await navigator.share(shareData); } catch (err) { } } 
                else {
                    const textArea = document.createElement("textarea"); textArea.value = `Baixe ${app.name} na Nexus Store! ${app.downloadUrl || ''}`;
                    document.body.appendChild(textArea); textArea.select();
                    try { document.execCommand('copy'); alert('Link copiado!'); } catch (err) {}
                    document.body.removeChild(textArea);
                }
            };

            const displayApp = isEffectiveLocked ? { ...app, name: "???", developer: "???", description: "Conte√∫do confidencial. Aguarde a revela√ß√£o.", icon: null } : app;

            return (
                <div className={`fixed inset-0 z-50 ${colors.bg} ${colors.text} view-animate flex flex-col overflow-y-auto`}>
                    {showWarning && (
                        <div className="absolute inset-0 z-[60] bg-black/60 backdrop-blur-md flex items-center justify-center p-8 animate-fade-in">
                            <div className={`${colors.card} p-6 rounded-3xl w-full max-w-sm shadow-2xl text-center border ${colors.border}`}>
                                <div className="w-12 h-12 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-4"><Icon name="AlertTriangle" className="text-yellow-500" size={24} /></div>
                                <h3 className="font-bold text-lg mb-2">Aten√ß√£o</h3>
                                <p className={`${colors.subtext} text-sm mb-6 leading-relaxed`}>{app.warningMessage}</p>
                                <button onClick={() => setShowWarning(false)} className={`w-full py-3 ${themeMode === 'light' ? 'bg-black text-white' : 'bg-white text-black'} font-bold rounded-xl text-sm`}>Entendido</button>
                            </div>
                        </div>
                    )}

                    <div className={`sticky top-0 z-30 flex justify-between items-center p-4 ${colors.glass} backdrop-blur-xl`}>
                        <button onClick={onClose} style={{color: accentColor}} className="w-9 h-9 rounded-full bg-zinc-800/50 flex items-center justify-center backdrop-blur-md"><Icon name="ChevronLeft" size={22} /></button>
                    </div>

                    <div className="px-5 pb-40 animate-scale-in">
                        <div className="flex gap-5 mb-8">
                            <div className={`w-28 h-28 shrink-0 rounded-[22%] shadow-2xl overflow-hidden ${isEffectiveLocked ? `${colors.card} flex items-center justify-center` : ''}`}>
                                {isEffectiveLocked ? <span className={`text-4xl font-black ${colors.subtext}`}>?</span> : <img src={displayApp.icon} className="w-full h-full object-cover" />}
                            </div>
                            <div className="flex flex-col justify-center min-w-0">
                                <h1 className="text-xl font-bold leading-tight mb-1">{displayApp.name}</h1>
                                <p className={`${colors.subtext} text-xs font-medium mb-4 uppercase tracking-wide`}>{displayApp.developer}</p>
                                <div className="flex items-center gap-3">
                                    <button onClick={handleDownload} disabled={isPreOrder} style={{ backgroundColor: isPreOrder ? undefined : accentColor }} className={`px-6 py-2 rounded-full font-bold text-xs uppercase tracking-wider transition-transform active:scale-95 flex items-center gap-2 ${isPreOrder ? 'bg-zinc-800 text-zinc-500' : 'text-white shadow-lg'}`}>
                                        <Icon name="Download" size={14} />
                                        {isPreOrder ? 'EM BREVE' : 'OBTER'}
                                    </button>
                                    <button onClick={handleShare} style={{color: accentColor}} className={`w-9 h-9 rounded-full ${colors.input} flex items-center justify-center active:scale-90 transition-transform`}><Icon name="Share" size={18} /></button>
                                </div>
                            </div>
                        </div>

                        <div className={`flex justify-between border-b ${colors.border} pb-6 mb-6 overflow-x-auto`}>
                            <div className={`px-4 text-center border-r ${colors.border} last:border-0 flex-1`}>
                                <p className={`text-[10px] ${colors.subtext} font-bold uppercase mb-1`}>Classifica√ß√£o</p>
                                <p className={`text-xl font-bold ${themeMode === 'light' ? 'text-black' : 'text-zinc-300'}`}>{displayApp.rating}</p>
                                <p className={`text-[9px] ${colors.subtext}`}>Anos</p>
                            </div>
                            <div className={`px-4 text-center border-r ${colors.border} last:border-0 flex-1`}>
                                <p className={`text-[10px] ${colors.subtext} font-bold uppercase mb-1`}>Categoria</p>
                                <Icon name="Grid" size={20} className={`mx-auto ${colors.subtext} mb-0.5`} />
                                <p className={`text-[9px] ${colors.subtext}`}>{displayApp.category}</p>
                            </div>
                            <div className="px-4 text-center flex-1">
                                <p className={`text-[10px] ${colors.subtext} font-bold uppercase mb-1`}>Plataforma</p>
                                <p className={`text-sm font-bold ${colors.subtext} mt-1`}>{displayApp.platform || 'Mobile'}</p>
                            </div>
                        </div>

                        <div className="mb-8">
                            <h2 className="text-lg font-bold mb-3">Novidades</h2>
                            <div className={`flex justify-between ${colors.subtext} text-xs font-medium mb-3`}><span>Vers√£o {displayApp.version}</span><span>{formatShortDate(now)}</span></div>
                            <p className={`${colors.subtext} text-sm leading-relaxed opacity-90`}>{displayApp.updateNews || 'Melhorias de desempenho e corre√ß√µes de bugs.'}</p>
                        </div>

                        <div className="mb-8">
                            <h2 className="text-lg font-bold mb-4">Pr√©-visualiza√ß√£o</h2>
                            <div className="flex gap-4 overflow-x-auto no-scrollbar snap-x -mx-5 px-5">
                                {displayApp.screenshots?.map((s, i) => <img key={i} src={s} className={`h-[400px] w-auto rounded-[32px] snap-center shadow-lg ${colors.input} object-cover`} />)}
                            </div>
                        </div>

                        <div className={`border-t ${colors.border} pt-6`}>
                            <p className={`${colors.subtext} text-sm leading-relaxed whitespace-pre-wrap opacity-90`}>{displayApp.description}</p>
                        </div>
                    </div>
                </div>
            );
        }

        // --- Profile Modal (Cleaned up) ---
        function ProfileModal({ isAdmin, setAdmin, onClose, profileImage, onImageUpload, theme, setTheme, accentColor, setAccentColor }) {
            const [activeTab, setActiveTab] = useState('general');
            const [userLogin, setUserLogin] = useState('');
            const [passLogin, setPassLogin] = useState('');
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [devClicks, setDevClicks] = useState(0);
            const fileInputRef = useRef(null);
            const colors = THEMES[theme] || THEMES.amoled;
            const currentUsername = localStorage.getItem('nexus_username');

            const handleDevClick = () => {
                const newCount = devClicks + 1;
                setDevClicks(newCount);
                if (newCount === 7) { setShowAdminLogin(true); alert("Modo Dev: Login Admin"); }
            };

            const handleLogin = () => {
                if (userLogin === 'DN' && passLogin === 'dnvy2205ZX@') {
                    setAdmin(true);
                    alert("Agora voc√™ √© Admin! Acesse as Configura√ß√µes no topo.");
                    onClose();
                } else alert("Erro.");
            };

             const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = async () => {
                         const imgData = reader.result;
                         onImageUpload(imgData);
                         if(!isAdmin && currentUsername) {
                             await db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('accounts').collection('users').doc(currentUsername).update({ image: imgData });
                         }
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="fixed inset-0 z-[200] bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 animate-fade-in">
                    <div className={`${colors.card} w-full max-w-sm rounded-[32px] p-6 shadow-2xl relative border ${colors.border} flex flex-col`}>
                        <header className="flex justify-between items-center mb-6">
                            <h2 className={`text-xl font-bold ${colors.text}`}>Conta</h2>
                            <button onClick={onClose} style={{color: accentColor}} className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${colors.input}`}><Icon name="X" size={18} /></button>
                        </header>
                        <div className="flex flex-col items-center mb-6">
                             <div onClick={() => fileInputRef.current?.click()} className={`w-20 h-20 rounded-full ${colors.input} border-4 ${colors.card} shadow-xl overflow-hidden relative group cursor-pointer`}>
                                {profileImage ? <img src={profileImage} className="w-full h-full object-cover" /> : <Icon name="Camera" size={28} className={`text-zinc-500 m-auto mt-6`} />}
                            </div>
                            <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileChange} />
                            <p className={`text-lg font-bold mt-3 ${colors.text}`}>{isAdmin ? 'Admin' : (currentUsername || 'Membro')}</p>
                            <p onClick={!isAdmin ? handleDevClick : undefined} className={`text-xs font-medium ${colors.subtext} cursor-pointer`}>{isAdmin ? 'Acesso Total' : 'Usu√°rio Padr√£o'}</p>
                        </div>
                        
                        <p className={`text-[10px] font-bold uppercase mb-2 ml-1 ${colors.subtext}`}>Tema</p>
                        <div className={`p-1 ${colors.input} rounded-xl mb-4 flex gap-1`}>
                            {['amoled', 'matte', 'light'].map(t => (
                                <button key={t} onClick={() => setTheme(t)} className={`flex-1 py-2 text-[10px] font-bold uppercase rounded-lg transition-all ${theme === t ? (t==='light' ? 'bg-white text-black shadow-sm' : 'bg-zinc-800 text-white shadow-sm') : colors.subtext}`}>{t}</button>
                            ))}
                        </div>
                         <p className={`text-[10px] font-bold uppercase mb-2 ml-1 ${colors.subtext}`}>Acento</p>
                        <div className={`p-2 ${colors.input} rounded-xl mb-6 flex justify-between gap-1`}>
                            {Object.entries(ACCENT_COLORS).map(([key, val]) => (
                                <button key={key} onClick={() => setAccentColor(val.hex)} className={`w-8 h-8 rounded-full border-2 transition-transform active:scale-90 flex items-center justify-center ${accentColor === val.hex ? 'border-white scale-110' : 'border-transparent'}`} style={{ backgroundColor: val.hex }}>{accentColor === val.hex && <Icon name="Check" size={14} className="text-white" />}</button>
                            ))}
                        </div>

                         {!isAdmin && showAdminLogin && (
                             <div className="flex flex-col gap-2 animate-scale-in mb-4">
                                <input type="text" placeholder="User" className={`w-full ${colors.input} rounded-xl px-4 py-2 text-xs ${colors.text}`} value={userLogin} onChange={e => setUserLogin(e.target.value)} />
                                <input type="password" placeholder="Pass" className={`w-full ${colors.input} rounded-xl px-4 py-2 text-xs ${colors.text}`} value={passLogin} onChange={e => setPassLogin(e.target.value)} />
                                <button onClick={handleLogin} style={{backgroundColor: accentColor}} className="w-full py-2 rounded-xl text-white text-xs font-bold">Entrar Admin</button>
                             </div>
                         )}

                         <button onClick={() => { if(isAdmin) setAdmin(false); else { localStorage.removeItem('nexus_logged_in'); location.reload(); } }} className="w-full mt-2 py-4 text-red-500 text-sm font-bold bg-red-500/10 rounded-xl">{isAdmin ? 'Sair do Admin' : 'Sair da Conta'}</button>
                    </div>
                </div>
            );
        }

        // --- Restored App Logic & Main Component ---
        
        function App() {
            const [view, setView] = useState('loading');
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('today');
            const [theme, setTheme] = useState(() => localStorage.getItem('nexus_theme') || 'amoled');
            const [accentColor, setAccentColor] = useState(() => localStorage.getItem('nexus_accent') || ACCENT_COLORS.blue.hex);
            const [isAdmin, setIsAdmin] = useState(() => localStorage.getItem('nexus_admin_status') === 'true');
            
            // Data
            const [apps, setApps] = useState([]);
            const [highlights, setHighlights] = useState([]);
            const [profileImage, setProfileImage] = useState(null);
            const [noticeConfig, setNoticeConfig] = useState({ active: false, title: '', message: '' });
            const [isMaintenance, setIsMaintenance] = useState(false);

            // Modals & UI States
            const [selectedApp, setSelectedApp] = useState(null);
            const [editingApp, setEditingApp] = useState(null);
            const [editingHighlight, setEditingHighlight] = useState(null);
            
            const [showSettings, setShowSettings] = useState(false);
            const [showAdminModal, setShowAdminModal] = useState(false);
            const [showHighlightModal, setShowHighlightModal] = useState(false);
            const [showProfile, setShowProfile] = useState(false);
            const [showScheduled, setShowScheduled] = useState(false);
            const [showRobot, setShowRobot] = useState(true);
            const [showNotice, setShowNotice] = useState(false);
            const [toast, setToast] = useState(null); 

            const colors = THEMES[theme] || THEMES.amoled;

            useEffect(() => {
                const handleToast = (e) => setToast(e.detail);
                window.addEventListener('nexus-toast', handleToast);
                return () => window.removeEventListener('nexus-toast', handleToast);
            }, []);

            const setAdminState = (status) => { 
                setIsAdmin(status); 
                if (status) localStorage.setItem('nexus_admin_status', 'true'); 
                else localStorage.removeItem('nexus_admin_status'); 
            };
            const handleSetTheme = (newTheme) => { setTheme(newTheme); localStorage.setItem('nexus_theme', newTheme); };
            const handleSetAccent = (newHex) => { setAccentColor(newHex); localStorage.setItem('nexus_accent', newHex); };

            const handleLogin = (isAdminUser, username, customImage) => {
                localStorage.setItem('nexus_username', username);
                if(isAdminUser) setAdminState(true);
                localStorage.setItem('nexus_logged_in', 'true');
                if(customImage) setProfileImage(customImage);
                setShowRobot(true);
                setView('store');
            };

            const toggleMaintenance = async () => {
                const newState = !isMaintenance;
                setIsMaintenance(newState);
                await db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('config').set({ maintenance: newState }, { merge: true });
            };

            const handleRobotComplete = () => {
                setShowRobot(false);
                if (noticeConfig.active) {
                    setShowNotice(true);
                }
            };

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => { 
                    setUser(u); 
                    if(localStorage.getItem('nexus_logged_in') === 'true') {
                        const storedUser = localStorage.getItem('nexus_username');
                        if (storedUser && storedUser !== 'DN') {
                             db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('accounts').collection('users').doc(storedUser).get().then(doc => {
                                 if(doc.exists && doc.data().image) setProfileImage(doc.data().image);
                             });
                        }
                        setShowRobot(true);
                        setView('store');
                    } else {
                        setView('login');
                    }
                });
                if (!auth.currentUser) auth.signInAnonymously();
                return unsub;
            }, []);

            useEffect(() => {
                if (!user) return;
                const ref = db.collection('artifacts').doc(DB_APP_ID);
                const u1 = ref.collection('public').doc('data').collection('apps').onSnapshot(s => setApps(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const u2 = ref.collection('public').doc('data').collection('highlights').onSnapshot(s => setHighlights(s.docs.map(d => ({id: d.id, ...d.data()}))));
                const u3 = ref.collection('public').doc('config').onSnapshot(d => {
                    if (d.exists) {
                        const data = d.data();
                        setIsMaintenance(data.maintenance || false);
                        setNoticeConfig(data.notice || { active: false, title: '', message: '' });
                    }
                });
                const u4 = ref.collection('users').doc(user.uid).collection('profile').doc('info').onSnapshot(d => { if(d.exists && isAdmin) setProfileImage(d.data().image); });
                return () => { u1(); u2(); u3(); u4(); };
            }, [user, isAdmin]);

            const handleImageUpload = async (base64) => { 
                setProfileImage(base64);
                const currentUsername = localStorage.getItem('nexus_username');
                if(!isAdmin && currentUsername) {
                     await db.collection('artifacts').doc(DB_APP_ID).collection('public').doc('accounts').collection('users').doc(currentUsername).update({ image: base64 });
                }
                if (user) await db.collection('artifacts').doc(DB_APP_ID).collection('users').doc(user.uid).collection('profile').doc('info').set({ image: base64 }, { merge: true }); 
            };

            if (isMaintenance && !isAdmin) return <MaintenanceView onAdminLogin={setAdminState} accentColor={accentColor} />;
            if (view === 'loading') return <div className="h-screen bg-black flex items-center justify-center"><div className="w-10 h-10 border-4 rounded-full animate-spin border-t-transparent" style={{borderColor: accentColor, borderTopColor: 'transparent'}}></div></div>;
            if (view === 'login') return <LoginView onLogin={handleLogin} />;

            return (
                <div className={`h-screen w-full ${colors.bg} overflow-hidden flex flex-col font-sans transition-colors duration-300`}>
                    
                    {/* Overlays */}
                    {showRobot && <NexusBot mode="greeting" message={`Olaa, <span style="color: ${accentColor}">${localStorage.getItem('nexus_username') || 'Visitante'}</span>!`} accentColor={accentColor} onComplete={handleRobotComplete} />}
                    
                    {showNotice && !showRobot && <NoticePopup config={noticeConfig} onClose={() => setShowNotice(false)} accentColor={accentColor} />}
                    
                    {toast && <Toast title={toast.title} body={toast.body} icon={toast.icon} themeMode={theme} onClose={() => setToast(null)} />}

                    <div className="flex-1 overflow-y-auto pb-40 no-scrollbar relative">
                        {activeTab === 'today' && <TodayView key="today" apps={apps} highlights={highlights} onProfile={() => setShowProfile(true)} onSettings={() => setShowSettings(true)} onApp={setSelectedApp} isAdmin={isAdmin} profileImage={profileImage} themeMode={theme} accentColor={accentColor} />}
                        {activeTab === 'games' && <GenericTabView key="games" title="Jogos" apps={apps.filter(a => a.category === 'Jogos')} onApp={setSelectedApp} isAdmin={isAdmin} themeMode={theme} accentColor={accentColor} />}
                        {activeTab === 'apps' && <GenericTabView key="apps" title="Apps" apps={apps.filter(a => a.category !== 'Jogos' && a.category !== 'PC')} onApp={setSelectedApp} isAdmin={isAdmin} themeMode={theme} accentColor={accentColor} />}
                        {activeTab === 'pc' && <GenericTabView key="pc" title="PC" apps={apps.filter(a => a.category === 'PC')} onApp={setSelectedApp} isAdmin={isAdmin} themeMode={theme} accentColor={accentColor} />}
                        {activeTab === 'search' && <SearchView key="search" apps={apps} onApp={setSelectedApp} onProfile={() => setShowProfile(true)} profileImage={profileImage} themeMode={theme} accentColor={accentColor} />}
                    </div>

                    <nav className={`fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-[400px] px-6 py-4 rounded-[30px] flex justify-between items-center z-50 border shadow-dock backdrop-blur-xl ${colors.dock} ${colors.border} transition-colors duration-300`}>
                        <TabButton active={activeTab === 'today'} icon="Calendar" label="Hoje" onClick={() => setActiveTab('today')} themeMode={theme} accentColor={accentColor} />
                        <TabButton active={activeTab === 'games'} icon="Gamepad2" label="Jogos" onClick={() => setActiveTab('games')} themeMode={theme} accentColor={accentColor} />
                        <TabButton active={activeTab === 'apps'} icon="AppWindow" label="Apps" onClick={() => setActiveTab('apps')} themeMode={theme} accentColor={accentColor} />
                        <TabButton active={activeTab === 'pc'} icon="Monitor" label="PC" onClick={() => setActiveTab('pc')} themeMode={theme} accentColor={accentColor} />
                        <TabButton active={activeTab === 'search'} icon="Search" label="Busca" onClick={() => setActiveTab('search')} themeMode={theme} accentColor={accentColor} />
                    </nav>

                    {/* Modals */}
                    {selectedApp && <AppDetail app={selectedApp} onClose={() => setSelectedApp(null)} themeMode={theme} accentColor={accentColor} />}
                    
                    {/* Admin Modals */}
                    {showSettings && (
                        <SettingsModal 
                            onClose={() => setShowSettings(false)} 
                            accentColor={accentColor} 
                            themeMode={theme} 
                            onAddApp={() => { setShowSettings(false); setEditingApp(null); setShowAdminModal(true); }}
                            onAddStory={() => { setShowSettings(false); setEditingHighlight(null); setShowHighlightModal(true); }}
                            onSchedule={() => { setShowSettings(false); setShowScheduled(true); }}
                            maintenance={isMaintenance}
                            toggleMaintenance={toggleMaintenance}
                            noticeConfig={noticeConfig}
                            setNoticeConfig={setNoticeConfig}
                        />
                    )}

                    {showAdminModal && <AdminAppModal editingApp={editingApp} onClose={() => setShowAdminModal(false)} accentColor={accentColor} />}
                    {showHighlightModal && <HighlightModal editingHighlight={editingHighlight} apps={apps} onClose={() => setShowHighlightModal(false)} accentColor={accentColor} />}
                    {showScheduled && <ScheduledView apps={apps} highlights={highlights} onClose={() => setShowScheduled(false)} onEditApp={(a) => { setEditingApp(a); setShowAdminModal(true); }} onEditHigh={(h) => { setEditingHighlight(h); setShowHighlightModal(true); }} accentColor={accentColor} />}
                    
                    {showProfile && <ProfileModal isAdmin={isAdmin} setAdmin={setAdminState} onClose={() => setShowProfile(false)} profileImage={profileImage} onImageUpload={handleImageUpload} theme={theme} setTheme={handleSetTheme} accentColor={accentColor} setAccentColor={handleSetAccent} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
